@model List<TTTStatisticsLibrary.Statistic>

@{
    ViewBag.Title = "Статистика игры Tic-Tac-Toe";
}
<div class="alert alert-info" role="alert" id="human">
    Процент побед человека: @ViewBag.HumanPercent%
</div>
<div class="alert alert-info" role="alert" id="computer">
    Процент побед компьютера: @ViewBag.ComputerPercent%
</div>
<div class="alert alert-info" role="alert" id="tic">
    Процент побед крестиков (Tic): @ViewBag.TicPercent%
</div>
<div class="alert alert-info" role="alert" id="tac">
    Процент побед ноликов (Tac): @ViewBag.TacPercent%
</div>
<div class="panel panel-primary">
    <div class="panel-heading">
        Статистика игр
    </div>
    <div class="panel-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="statsTable">
                <tr>
                    <th>Дата и время игры</th>
                    <th>Число ходов</th>
                    <th>Игрок за крестики (Tic)</th>
                    <th>Игрок за нолики (Tac)</th>
                    <th>Результат игры</th>
                </tr>
                @foreach (var statistic in Model)
                {
                    <tr>
                        <td>@statistic.GameDate</td>
                        <td>@statistic.MovesCount</td>
                        <td>@statistic.TicPlayer</td>
                        <td>@statistic.TacPlayer</td>
                        <td>@statistic.GameResult</td>
                    </tr>
                }
            </table>
        </div>
    </div>
</div>

@section scripts {
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var chat = $.connection.statisticsHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.addStatistics = function (jsonString, playerPercent, computerPercent, ticPercent, tacPercent) {
                var stats = JSON.parse(jsonString);
                var date = new Date(stats.GameDate);
                $("#statsTable tbody").append("<tr>" +
                        "<td>" + date.toLocaleDateString() + " " + date.toLocaleTimeString() + "</td>" +
                        "<td>" + stats.MovesCount + "</td>" +
                        "<td>" + stats.TicPlayer + "</td>" +
                        "<td>" + stats.TacPlayer + "</td>" +
                        "<td>" + stats.GameResult + "</td>" +
                    "</tr>");
                $("#human").html("Процент побед человека: " + playerPercent + "%");
                $("#computer").html("Процент побед компьютера: " + computerPercent + "%");
                $("#tic").html("Процент побед крестиков (Tic): " + ticPercent + "%");
                $("#tac").html("Процент побед ноликов (Tac): " + tacPercent + "%");
            };
            // Start the connection.
            $.connection.hub.start();
        });
    </script>
}