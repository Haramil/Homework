@model List<TTTStatisticsLibrary.Statistics>

@{
    ViewBag.Title = "Статистика";
}
<div class="alert alert-info" role="alert" id="human">
    Процент побед человека: @ViewBag.HumanPercent%
</div>
<div class="alert alert-info" role="alert" id="computer">
    Процент побед компьютера: @ViewBag.ComputerPercent%
</div>
<div class="alert alert-info" role="alert" id="tic">
    Процент побед крестиков: @ViewBag.TicPercent%
</div>
<div class="alert alert-info" role="alert" id="tac">
    Процент побед ноликов: @ViewBag.TacPercent%
</div>
<div class="table-responsive" id="statsTable">
    <table class="table table-bordered" id="tabb">
        <tr>
            <th>Дата и время игры</th>
            <th>Число ходов</th>
            <th>Игрок за крестики</th>
            <th>Игрок за нолики</th>
            <th>Результат игры</th>
        </tr>
        @foreach (var statistic in Model)
        {
            <tr>
                <td>@statistic.GameDate</td>
                <td>@statistic.MovesCount</td>
                <td>@statistic.TicPlayer</td>
                <td>@statistic.TacPlayer</td>
                <td>@statistic.GameResult</td>
            </tr>
        }
    </table>
</div>

@section scripts {
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var chat = $.connection.statisticsHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.addStatistics = function (jsonString, playerPercent, computerPercent, ticPercent, tacPercent) {
                var stats = JSON.parse(jsonString);
                var date = new Date(stats.GameDate);
                $("#statsTable tbody").append("<tr>" +
                        "<td>" + date.toLocaleDateString() + " " + date.toLocaleTimeString() + "</td>" +
                        "<td>" + stats.MovesCount + "</td>" +
                        "<td>" + stats.TicPlayer + "</td>" +
                        "<td>" + stats.TacPlayer + "</td>" +
                        "<td>" + stats.GameResult + "</td>" +
                    "</tr>");
                $("#human").html("Процент побед человека: " + playerPercent + "%");
                $("#computer").html("Процент побед компьютера: " + computerPercent + "%");
                $("#tic").html("Процент побед крестиков: " + ticPercent + "%");
                $("#tac").html("Процент побед ноликов: " + tacPercent + "%");
            };
            // Start the connection.
            $.connection.hub.start();
        });
    </script>
}